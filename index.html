<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>9호선 노선도</title>
<style>
  body { margin: 0; padding: 20px; background-color: #f0f2f5; font-family: Arial, sans-serif; overflow-x: auto; }
  #uploadStatus { font-weight: bold; color: green; margin-bottom: 10px; }
  .lines-wrapper { display: flex; flex-direction: column; align-items: flex-start; gap: 100px; min-width: max-content; }
  .line-section { display: flex; flex-direction: column; align-items: flex-start; gap: 50px; }
  .line-title { font-size: 20px; font-weight: bold; background-color: #FFCC00; padding: 6px 12px; border-radius: 12px; color: #333; }
  .legend { display: flex; gap: 20px; margin: 10px 0; font-size: 14px; }
  .legend-item { display: flex; align-items: center; gap: 6px; }
  .legend-line { width: 30px; height: 4px; border-radius: 2px; }
  .express-line, .normal-line, .base-line { position: absolute; height: 4px; }
  .express-line { top: -40px; left: 0; right: 0; background-color: #FF3B30; z-index: 1; }
  .normal-line { top: 110%; left: 0; right: 0; background-color: #FFCC00; z-index: 0; }
  .base-line { top: 7px; left: 50%; transform: translateX(-50%); width: calc(100% - 80px); background-color: #333; z-index: 0; }
  .line-container { display: flex; align-items: center; position: relative; white-space: nowrap; }
  .station { display: flex; flex-direction: column; align-items: center; margin: 0 20px; position: relative; }
  .station-point { width: 15px; height: 15px; background-color: #FFC300; border-radius: 50%; border: 1px solid #666; z-index: 2; }
  .station-name { margin-top: 10px; font-size: 13px; color: #444; text-align: center; }
  .station-time { margin-top: 6px; font-size: 10px; color: #555; height: 14px; text-align: center; }
</style>
</head>
<body>

<input type="file" id="excelUpload" style="margin-bottom: 8px;">
<p id="uploadStatus"></p>

<div class="lines-wrapper">
  <div class="legend">
    <div class="legend-item"><div class="legend-line" style="background-color: #FF3B30;"></div>급행</div>
    <div class="legend-item"><div class="legend-line" style="background-color: #FFCC00;"></div>일반</div>
  </div>

  <!-- 상선 -->
  <div class="line-section">
    <div class="line-title">상선 ▶️</div>
    <div class="line-container">
      <div class="express-line"></div><div class="base-line"></div><div class="normal-line"></div>
      <!-- 각 역 요소들 -->
      <!-- 예: -->
      <div class="station"><div class="station-point"></div><div class="station-name">개화</div><div class="station-time"></div></div>
      <!-- ... 이하 모든 역 동일하게 배치 ... -->
    </div>
  </div>

  <!-- 하선 -->
  <div class="line-section">
    <div class="line-title">하선 ▶️</div>
    <div class="line-container">
      <div class="express-line"></div><div class="base-line"></div><div class="normal-line"></div>
      <!-- 각 역 요소들 -->
      <div class="station"><div class="station-point"></div><div class="station-name">중앙보훈병원</div><div class="station-time"></div></div>
      <!-- ... 이하 모든 역 동일하게 배치 ... -->
    </div>
  </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const upload = document.getElementById("excelUpload");
  const status = document.getElementById("uploadStatus");

  upload.addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    status.textContent = "업로드 중…";
    status.style.color = "green";
    const form = new FormData();
    form.append("file", file);

    try {
      const res = await fetch("https://maintrans9-upload-6e3ba659a8bc.herokuapp.com/api/process", {
        method: "POST",
        body: form,
        mode: "cors"
      });
      if (!res.ok) throw new Error(res.statusText);
      const trains = await res.json();

      document.querySelectorAll(".station").forEach(el => {
        const name = el.querySelector(".station-name").textContent.trim();
        const match = trains.find(t => t.station && t.station.trim() === name);
        if (match && match.minutes !== undefined) {
          el.querySelector(".station-time").textContent = `도착까지 ${match.minutes}분`;
        } else {
          el.querySelector(".station-time").textContent = "";
          console.warn(`"${name}" 역 데이터 없음`);
        }
      });

      status.textContent = "업로드 및 분석 성공";
    } catch (err) {
      console.error("Upload error:", err);
      status.textContent = "업로드 실패: " + err.message;
      status.style.color = "red";
    }
  });
});
</script>

</body>
</html>
